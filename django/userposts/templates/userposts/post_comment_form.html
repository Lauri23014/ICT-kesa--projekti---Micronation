{% load static %}
<button onClick="commentForm{{ post.id }}()"><p>test</p></button>

<!--<form method="POST" action=" {% url "comment_post" username=post.user.username id=post.id %}" id="comment-form-{{ post.id }}">
	{% csrf_token %}
	<input type="hidden" name="next" value="{{ request.path }}">
	<input type="text" name="comment_text" maxlenght="255" placeholder="Type a reply!">
	<button type="submit"><p>Submit</p></button>
</form>-->

<script>
	function commentForm{{ post.id }}() {
		/* post you are replying to*/
		/* profile for post */
		const replyingTo = document.createElement("div");
		replyingTo.className = "post-block";
		const replyingToProfile = document.createElement("div");
		replyingToProfile.className = "profile-mini"
		replyingToProfile.onClick = "window.location.href = '{% url 'profile_page' username=post.user.username %}'";
		replyingTo.appendChild(replyingToProfile);
		{% if post.user.profile.profile_pic %}
			const replyingToPFP = document.createElement("img");
			replyingToPFP.className = "profile-picture";
			replyingToPFP.src = "/media/{{ post.user.profile.profile_pic }}";
			replyingToPFP.alt = "Profile Picture";
		{% else %}
			const replyingToPFP = document.createElement("img");
			replyingToPFP.className = "profile-picture";
			replyingToPFP.src = "{% static 'users/images/default-avatar.jpg' %}";
			replyingToPFP.alt = "Default Picture";
		{% endif %}
		const replyingToName = document.createElement("h3")
		replyingToName.innerText = "{{ post.user.username }}";
		replyingToProfile.appendChild(replyingToPFP);
		replyingToProfile.appendChild(replyingToName);
		/* post content */
		const replyingToPost = document.createElement("article");
		replyingToPost.className = "post-content";
		replyingToPost.onClick = "window.location.href = '/profile/{{ post.user.username }}/post/{{ post.id }}#selected-post'";
		replyingTo.appendChild(replyingToPost);
		const replyingToPostDiv = document.createElement("div");
		replyingToPostDiv.className = "post-content-div";
		replyingToPost.appendChild(replyingToPostDiv);
		{% if post.title %}
			const replyingToPostTitle = document.createElement("h2");
			replyingToPostTitle.innerText = "{{ post.title }}";
			replyingToPostDiv.appendChild(replyingToPostTitle);
		{% endif %}
		replyingToPostText = document.createElement("p");
		replyingToPostText.innerText = "{{ post.text_content|linebreaksbr }}";
		replyingToPostDiv.appendChild(replyingToPostText);
		{% if post.image_file.url != None %}
			const replyingToPostImg = document.createElement("img");
			replyingToPostImg.className = "post-image";
			replyingToPostImg.src = "{{ post.image_file.url }}";
			replyingToPostDiv.appendChild(replyingToPostImg);
		{% endif %}

		/* reply form */

		/* overlay and binding box */
		const overlay = document.createElement("div");
		overlay.className = "post-comment-form-overlay";
		overlay.id = "post-comment-form-overlay-{{ post.id }}";
		overlay.addEventListener("click", (click) => {remover{{ post.id }}(click)});

		const box = document.createElement("div");
		box.className = "post-segment";

		document.body.appendChild(overlay);
		overlay.appendChild(box);
		box.appendChild(replyingTo);
	}

	function remover{{ post.id }}(click) {
		const element = click.target;
		if (element.classList.contains("post-comment-form-overlay")) {
			document.getElementById("post-comment-form-overlay-{{ post.id }}").remove();
		}
	}

	/* document.getElementById("comment-form-{{ post.id }}").onsubmit = function(e) {
		e.preventDefault();
		let form = document.getElementById("comment-form-{{ post.id }}");
		let url = form.action;
		let formdata = new FormData(form);

		let options = {
			method: 'POST',      
			body: formdata
		};

		fetch(url, options)
		.then(response => response.json())
		.then((response) => {
			if (response.success) {
				window.alert("Success!");
			} else {
				window.alert("No Success :(")
			}
		})
	}*/
</script>